# Story 4.2: Sprint Capacity Management

## Status
Draft

---

## Story

**As a** scrum master,
**I want** to track sprint capacity and team workload,
**so that** I can prevent over-commitment and balance work distribution.

---

## Acceptance Criteria

1. Sprint detail view displays capacity utilization chart: progress bar showing used/total story points
2. Progress bar color-coded: green (<80%), yellow (80-100%), red (>100% over capacity)
3. Sprint sidebar shows quick stats: "24/40 points" with percentage "(60%)"
4. Adding card with story points to sprint auto-updates capacity calculation in real-time
5. Capacity chart breaks down by assignee: each team member shows allocated points vs personal capacity
6. Board members can set personal capacity in profile: "Story points per sprint" (default: 10)
7. Unassigned cards in sprint show in "Unassigned" section of capacity breakdown
8. Sprint planning mode allows drag-and-drop cards from backlog with live capacity feedback
9. Warning shown when dragging card would exceed sprint capacity: "This will exceed capacity by X points"
10. Sprint capacity configurable: edit sprint to change total capacity points

---

## Tasks / Subtasks

- [ ] **Task 1: Add capacity calculation service** (AC: 1, 2, 3, 4)
  - [ ] Calculate total story points in sprint
  - [ ] Calculate capacity utilization percentage
  - [ ] Return color code based on percentage

- [ ] **Task 2: Add personal capacity to User model** (AC: 6)
  - [ ] Add `story_points_per_sprint` field to users table (default 10)
  - [ ] API endpoint to update personal capacity

- [ ] **Task 3: Create capacity chart component** (AC: 1, 2, 5)
  - [ ] Display progress bar with utilization
  - [ ] Break down by assignee
  - [ ] Show unassigned cards separately

- [ ] **Task 4: Implement live capacity feedback** (AC: 8, 9)
  - [ ] Calculate new capacity when dragging card
  - [ ] Show warning tooltip if exceeds capacity
  - [ ] Color preview bar based on new utilization

- [ ] **Task 5: Write tests** (AC: 1-10)
  - [ ] Unit test: Capacity calculation with multiple cards
  - [ ] Component test: Capacity chart rendering

---

## Dev Notes

### Capacity Calculation

```python
def calculate_sprint_capacity(sprint: Sprint) -> dict:
    cards = sprint.cards
    total_points = sum(c.story_points or 0 for c in cards)
    capacity = sprint.capacity_points

    utilization = (total_points / capacity * 100) if capacity > 0 else 0

    if utilization < 80:
        color = "green"
    elif utilization <= 100:
        color = "yellow"
    else:
        color = "red"

    return {
        "total_points": total_points,
        "capacity": capacity,
        "utilization": utilization,
        "color": color
    }
```

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-23 | 1.0 | Initial story creation from PRD Epic 4 Story 4.2 | Sarah (PO Agent) |
