# Story 3.6: Commit History Timeline

## Status
Draft

---

## Story

**As a** team member,
**I want** to see commit history for linked PRs in the card timeline,
**so that** I can track code progress without leaving the board.

---

## Acceptance Criteria

1. Card activity timeline shows commits from linked PRs
2. Commit entries display: commit message (first line), author avatar, timestamp, SHA (short)
3. Clicking commit opens GitHub commit page in new tab
4. Webhook `push` event to PR branch triggers commit sync
5. Commits stored in `pull_requests.commit_count` and fetched on-demand from GitHub API
6. Timeline filters allow showing/hiding commits (toggle: "Show commits")
7. Commit messages support markdown links and issue references (#123)
8. Batch commit display: if >5 commits pushed at once, show summary "6 commits pushed" with expand button
9. Commits grouped by PR: timeline shows "PR #123" header with commits nested below
10. Force-pushed commits marked with warning icon and tooltip: "Force pushed (history rewritten)"

---

## Tasks / Subtasks

- [ ] **Task 1: Create commit data model** (AC: 5)
  - [ ] Create `Commit` model or store in PR metadata
  - [ ] Fields: sha, message, author_name, author_avatar, timestamp, pr_id

- [ ] **Task 2: Handle push webhook events** (AC: 4)
  - [ ] Parse `push` event for PR branches
  - [ ] Extract commit data from payload
  - [ ] Store commits or update PR commit_count

- [ ] **Task 3: Add commits to timeline** (AC: 1, 2, 3)
  - [ ] Fetch commits when loading card timeline
  - [ ] Display commit entries with author and message
  - [ ] Link to GitHub commit page

- [ ] **Task 4: Add timeline filters** (AC: 6)
  - [ ] Toggle to show/hide commits
  - [ ] Filter stored in user preferences

- [ ] **Task 5: Write tests** (AC: 1-10)
  - [ ] Integration test: Push webhook creates commit entries
  - [ ] Component test: Timeline displays commits

---

## Dev Notes

### Commit Timeline Entry

```typescript
// frontend/src/components/board/timeline-commit.tsx
export function TimelineCommit({ commit }: { commit: any }) {
  return (
    <div className="flex gap-3 text-sm">
      <Avatar className="h-6 w-6">
        <AvatarImage src={commit.author.avatar_url} />
      </Avatar>
      <div>
        <a href={commit.html_url} target="_blank" className="font-mono text-xs">
          {commit.sha.slice(0, 7)}
        </a>
        <p>{commit.commit.message.split('\n')[0]}</p>
        <span className="text-xs text-muted-foreground">
          {commit.author.login} Â· {formatDistanceToNow(new Date(commit.commit.author.date))}
        </span>
      </div>
    </div>
  )
}
```

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-23 | 1.0 | Initial story creation from PRD Epic 3 Story 3.6 | Sarah (PO Agent) |
