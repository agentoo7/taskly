# Story 1.5: User Landing Page & Navigation Shell

## Status
Draft

---

## Story

**As a** logged-in user,
**I want** to see a landing page with navigation structure,
**so that** I can understand the application layout and access future features.

---

## Acceptance Criteria

1. After successful login, user redirects to landing page (`/dashboard` or `/workspaces`)
2. Top navigation bar displays: Taskly logo, user avatar (from GitHub), username, logout button
3. Landing page shows "Welcome, [username]!" message confirming authentication worked
4. Navigation shell includes placeholder menu items: "Workspaces" (active), "Settings" (disabled/coming soon)
5. Clicking user avatar opens dropdown menu with: "Profile" (placeholder), "Settings" (placeholder), "Logout" (functional)
6. Logout button triggers logout endpoint, clears tokens, and redirects to login page
7. Responsive layout works on desktop (1280px+) and tablet (768px+) screen sizes
8. Dark mode toggle available in navigation (persists preference in localStorage, defaults to light mode)
9. Unauthenticated users accessing protected routes (`/dashboard`) automatically redirect to login page
10. Loading states display during authentication checks (prevent flash of incorrect content)
11. Error handling: if OAuth fails or GitHub API unreachable, display user-friendly error message with retry option

---

## Tasks / Subtasks

- [ ] **Task 1: Create dashboard layout with navigation** (AC: 1, 2, 4, 7)
  - [ ] Create `frontend/src/app/(dashboard)/layout.tsx` - authenticated layout wrapper
  - [ ] Create top navigation bar component: `frontend/src/components/layout/navbar.tsx`
  - [ ] Add Taskly logo (left side) with link to `/workspaces`
  - [ ] Add navigation menu items: "Workspaces" (active), "Settings" (disabled with tooltip "Coming soon")
  - [ ] Add user section (right side): avatar, username, dropdown trigger
  - [ ] Make navigation responsive: full nav on desktop, hamburger menu on tablet/mobile
  - [ ] Use shadcn/ui components: NavigationMenu, Avatar, DropdownMenu

- [ ] **Task 2: Create user dropdown menu** (AC: 5, 6, 8)
  - [ ] Create user menu dropdown with avatar as trigger
  - [ ] Add menu items: "Profile" (disabled), "Settings" (disabled), divider, "Dark Mode Toggle", divider, "Logout" (functional)
  - [ ] Implement logout: call `useAuth().logout()`, redirect to `/login`
  - [ ] Add dark mode toggle using next-themes library
  - [ ] Persist dark mode preference in localStorage
  - [ ] Display user info in menu header: avatar, username, email
  - [ ] Add hover states and keyboard navigation (arrow keys, Enter)

- [ ] **Task 3: Create workspaces landing page** (AC: 1, 3)
  - [ ] Create `frontend/src/app/(dashboard)/workspaces/page.tsx`
  - [ ] Fetch current user with `useAuth()` hook
  - [ ] Display welcome message: "Welcome, [username]!" with avatar
  - [ ] Add empty state: "You don't have any workspaces yet" with illustration
  - [ ] Add "Create Workspace" button (placeholder, will implement in Epic 2)
  - [ ] Show loading skeleton while fetching user data
  - [ ] Add error boundary for error handling

- [ ] **Task 4: Implement authentication middleware for route protection** (AC: 9)
  - [ ] Update `frontend/src/middleware.ts` to check authentication
  - [ ] Protected routes: `/workspaces`, `/settings`, `/profile`
  - [ ] Public routes: `/`, `/login`, `/auth/callback`
  - [ ] If unauthenticated accessing protected route, redirect to `/login?redirect=<path>`
  - [ ] If authenticated accessing login page, redirect to `/workspaces`
  - [ ] Store redirect URL in query param, restore after login

- [ ] **Task 5: Add loading states** (AC: 10)
  - [ ] Create loading skeleton component for navigation: `frontend/src/components/layout/navbar-skeleton.tsx`
  - [ ] Show navbar skeleton while `useAuth()` is loading
  - [ ] Create page loading component: `frontend/src/app/(dashboard)/loading.tsx`
  - [ ] Use Next.js Suspense boundaries for async components
  - [ ] Prevent flash of unauthenticated content (FOUC) by showing loading state
  - [ ] Add smooth transitions between loading and loaded states

- [ ] **Task 6: Implement error handling** (AC: 11)
  - [ ] Create error boundary component: `frontend/src/app/(dashboard)/error.tsx`
  - [ ] Handle authentication errors: expired token, invalid token, network failure
  - [ ] Display user-friendly error messages with retry button
  - [ ] If GitHub OAuth fails during callback, show error on login page
  - [ ] Add toast notifications for non-critical errors (using sonner library)
  - [ ] Log errors to console in development, Sentry in production

- [ ] **Task 7: Set up dark mode with next-themes** (AC: 8)
  - [ ] Install next-themes: `npm install next-themes`
  - [ ] Create theme provider: `frontend/src/components/providers/theme-provider.tsx`
  - [ ] Wrap app with ThemeProvider in root layout
  - [ ] Configure themes: light, dark, system (default)
  - [ ] Create dark mode toggle component with sun/moon icons
  - [ ] Update Tailwind config to support dark mode: `darkMode: ['class']`
  - [ ] Test theme persistence across page reloads

- [ ] **Task 8: Create sidebar navigation (optional, future enhancement)** (AC: 4)
  - [ ] Create collapsible sidebar: `frontend/src/components/layout/sidebar.tsx`
  - [ ] Show workspace list in sidebar (placeholder for now)
  - [ ] Add workspace switcher dropdown at top of sidebar
  - [ ] Add toggle button to collapse/expand sidebar
  - [ ] Persist sidebar state in localStorage
  - [ ] Make sidebar responsive: always visible on desktop, collapsible on tablet

- [ ] **Task 9: Style navigation with Tailwind and shadcn/ui** (AC: 2, 7)
  - [ ] Apply consistent spacing using 8px grid system
  - [ ] Use theme colors from `globals.css`: primary, secondary, muted, etc.
  - [ ] Add hover states to navigation items and buttons
  - [ ] Add focus indicators for keyboard navigation (visible outline)
  - [ ] Ensure text contrast meets WCAG AA standards (4.5:1 minimum)
  - [ ] Test responsive breakpoints: mobile (<768px), tablet (768-1024px), desktop (>1024px)

- [ ] **Task 10: Add keyboard shortcuts for navigation** (AC: 5)
  - [ ] Implement keyboard shortcut: `⌘+K` or `Ctrl+K` opens command palette (placeholder)
  - [ ] Implement keyboard shortcut: `?` opens keyboard shortcuts help modal
  - [ ] Add visual hint: "Press ⌘K for commands" in navigation
  - [ ] Create keyboard shortcuts help modal listing all shortcuts
  - [ ] Ensure navigation accessible via Tab key and arrow keys

- [ ] **Task 11: Write tests for navigation and auth flows** (AC: 1-11)
  - [ ] Component test: Navbar renders correctly with user data
  - [ ] Component test: User dropdown menu items display and logout works
  - [ ] Component test: Dark mode toggle changes theme
  - [ ] Integration test: Protected route redirects unauthenticated user to login
  - [ ] Integration test: Authenticated user can access workspaces page
  - [ ] E2E test: Full login flow from login page to workspaces page
  - [ ] E2E test: Logout flow clears tokens and redirects to login

---

## Dev Notes

### Layout Structure

```
Root Layout (app/layout.tsx)
├── Theme Provider
├── TanStack Query Provider
└── Body
    ├── Public Routes (auth) Layout
    │   ├── Login Page
    │   └── Callback Page
    │
    └── Protected Routes (dashboard) Layout
        ├── Navbar
        │   ├── Logo
        │   ├── Navigation Menu
        │   └── User Dropdown
        ├── Sidebar (optional)
        └── Page Content
            ├── Workspaces Page
            ├── Settings Page
            └── Profile Page
```

### Navigation Bar Component

```typescript
// frontend/src/components/layout/navbar.tsx
'use client'

import Link from 'next/link'
import { useAuth } from '@/lib/hooks/use-auth'
import { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar'
import { Button } from '@/components/ui/button'
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
import { Moon, Sun, LogOut, Settings, User } from 'lucide-react'
import { useTheme } from 'next-themes'

export function Navbar() {
  const { user, logout } = useAuth()
  const { theme, setTheme } = useTheme()

  if (!user) return <NavbarSkeleton />

  return (
    <header className="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
      <div className="container flex h-14 items-center">
        {/* Logo */}
        <Link href="/workspaces" className="mr-6 flex items-center space-x-2">
          <span className="font-bold text-xl">Taskly</span>
        </Link>

        {/* Navigation Menu */}
        <nav className="flex items-center space-x-6 text-sm font-medium">
          <Link
            href="/workspaces"
            className="transition-colors hover:text-foreground/80 text-foreground"
          >
            Workspaces
          </Link>
          <span className="text-muted-foreground cursor-not-allowed">
            Settings
          </span>
        </nav>

        {/* User Section */}
        <div className="ml-auto flex items-center space-x-4">
          <DropdownMenu>
            <DropdownMenuTrigger asChild>
              <Button variant="ghost" className="relative h-8 w-8 rounded-full">
                <Avatar className="h-8 w-8">
                  <AvatarImage src={user.avatar_url} alt={user.username} />
                  <AvatarFallback>{user.username[0].toUpperCase()}</AvatarFallback>
                </Avatar>
              </Button>
            </DropdownMenuTrigger>
            <DropdownMenuContent className="w-56" align="end">
              <DropdownMenuLabel>
                <div className="flex flex-col space-y-1">
                  <p className="text-sm font-medium">{user.username}</p>
                  <p className="text-xs text-muted-foreground">{user.email}</p>
                </div>
              </DropdownMenuLabel>
              <DropdownMenuSeparator />
              <DropdownMenuItem disabled>
                <User className="mr-2 h-4 w-4" />
                Profile
              </DropdownMenuItem>
              <DropdownMenuItem disabled>
                <Settings className="mr-2 h-4 w-4" />
                Settings
              </DropdownMenuItem>
              <DropdownMenuSeparator />
              <DropdownMenuItem onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}>
                {theme === 'dark' ? (
                  <Sun className="mr-2 h-4 w-4" />
                ) : (
                  <Moon className="mr-2 h-4 w-4" />
                )}
                Toggle theme
              </DropdownMenuItem>
              <DropdownMenuSeparator />
              <DropdownMenuItem onClick={logout}>
                <LogOut className="mr-2 h-4 w-4" />
                Logout
              </DropdownMenuItem>
            </DropdownMenuContent>
          </DropdownMenu>
        </div>
      </div>
    </header>
  )
}

function NavbarSkeleton() {
  return (
    <header className="sticky top-0 z-50 w-full border-b bg-background">
      <div className="container flex h-14 items-center">
        <div className="h-6 w-24 bg-muted animate-pulse rounded" />
        <div className="ml-auto h-8 w-8 bg-muted animate-pulse rounded-full" />
      </div>
    </header>
  )
}
```

### Workspaces Landing Page

```typescript
// frontend/src/app/(dashboard)/workspaces/page.tsx
'use client'

import { useAuth } from '@/lib/hooks/use-auth'
import { Button } from '@/components/ui/button'
import { Card } from '@/components/ui/card'
import { Plus } from 'lucide-react'

export default function WorkspacesPage() {
  const { user, isLoading } = useAuth()

  if (isLoading) {
    return <WorkspacesPageSkeleton />
  }

  return (
    <div className="container py-8">
      <div className="mb-8">
        <h1 className="text-3xl font-bold tracking-tight">
          Welcome, {user?.username}!
        </h1>
        <p className="text-muted-foreground mt-2">
          Manage your workspaces and start collaborating on projects.
        </p>
      </div>

      {/* Empty State */}
      <Card className="flex flex-col items-center justify-center p-12 text-center">
        <div className="mb-4 rounded-full bg-muted p-6">
          <svg
            className="h-12 w-12 text-muted-foreground"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth={2}
              d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"
            />
          </svg>
        </div>
        <h3 className="text-lg font-semibold">No workspaces yet</h3>
        <p className="mt-2 text-sm text-muted-foreground max-w-sm">
          Get started by creating your first workspace to organize your boards and collaborate with your team.
        </p>
        <Button className="mt-6" size="lg">
          <Plus className="mr-2 h-4 w-4" />
          Create Workspace
        </Button>
      </Card>
    </div>
  )
}

function WorkspacesPageSkeleton() {
  return (
    <div className="container py-8">
      <div className="mb-8">
        <div className="h-10 w-64 bg-muted animate-pulse rounded" />
        <div className="mt-2 h-6 w-96 bg-muted animate-pulse rounded" />
      </div>
      <div className="h-64 bg-muted animate-pulse rounded" />
    </div>
  )
}
```

### Theme Provider Setup

```typescript
// frontend/src/components/providers/theme-provider.tsx
'use client'

import { ThemeProvider as NextThemesProvider } from 'next-themes'
import { type ThemeProviderProps } from 'next-themes/dist/types'

export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>
}
```

```typescript
// frontend/src/app/layout.tsx
import { ThemeProvider } from '@/components/providers/theme-provider'
import { QueryProvider } from '@/components/providers/query-provider'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body>
        <ThemeProvider
          attribute="class"
          defaultTheme="system"
          enableSystem
          disableTransitionOnChange
        >
          <QueryProvider>
            {children}
          </QueryProvider>
        </ThemeProvider>
      </body>
    </html>
  )
}
```

### Protected Route Middleware

```typescript
// frontend/src/middleware.ts
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'

const protectedRoutes = ['/workspaces', '/settings', '/profile']
const authRoutes = ['/login']

export function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl
  const accessToken = request.cookies.get('access_token')?.value ||
    request.headers.get('authorization')?.split('Bearer ')[1]

  const isProtectedRoute = protectedRoutes.some((route) => pathname.startsWith(route))
  const isAuthRoute = authRoutes.some((route) => pathname.startsWith(route))

  // Redirect unauthenticated users from protected routes to login
  if (isProtectedRoute && !accessToken) {
    const loginUrl = new URL('/login', request.url)
    loginUrl.searchParams.set('redirect', pathname)
    return NextResponse.redirect(loginUrl)
  }

  // Redirect authenticated users from auth routes to dashboard
  if (isAuthRoute && accessToken) {
    return NextResponse.redirect(new URL('/workspaces', request.url))
  }

  return NextResponse.next()
}

export const config = {
  matcher: ['/((?!api|_next/static|_next/image|favicon.ico|public).*)'],
}
```

### Responsive Design Breakpoints

```typescript
// Tailwind breakpoints (defined in tailwind.config.ts)
// sm: 640px   - Mobile landscape
// md: 768px   - Tablet portrait
// lg: 1024px  - Tablet landscape
// xl: 1280px  - Desktop
// 2xl: 1536px - Large desktop

// Usage in components:
<div className="flex flex-col md:flex-row lg:space-x-4">
  {/* Mobile: stacked, Tablet+: horizontal */}
</div>
```

### Testing

**Component Test - Navbar:**
```typescript
// frontend/tests/unit/components/layout/navbar.test.tsx
import { render, screen, fireEvent } from '@testing-library/react'
import { Navbar } from '@/components/layout/navbar'
import { useAuth } from '@/lib/hooks/use-auth'

vi.mock('@/lib/hooks/use-auth')

describe('Navbar', () => {
  it('renders user info and logout button', () => {
    useAuth.mockReturnValue({
      user: { username: 'alice', email: 'alice@example.com', avatar_url: '/avatar.jpg' },
      logout: vi.fn(),
    })

    render(<Navbar />)

    expect(screen.getByText('alice')).toBeInTheDocument()
    expect(screen.getByText('Logout')).toBeInTheDocument()
  })

  it('calls logout when logout button clicked', () => {
    const mockLogout = vi.fn()
    useAuth.mockReturnValue({
      user: { username: 'alice', email: 'alice@example.com', avatar_url: '/avatar.jpg' },
      logout: mockLogout,
    })

    render(<Navbar />)
    fireEvent.click(screen.getByText('Logout'))

    expect(mockLogout).toHaveBeenCalled()
  })
})
```

**E2E Test - Login to Dashboard:**
```typescript
// frontend/tests/e2e/auth-flow.spec.ts
import { test, expect } from '@playwright/test'

test('authenticated user sees workspaces page', async ({ page }) => {
  // Mock GitHub OAuth callback
  await page.goto('/auth/callback?code=test_code')

  // Should redirect to workspaces
  await expect(page).toHaveURL('/workspaces')

  // Should see welcome message
  await expect(page.locator('text=Welcome,')).toBeVisible()

  // Should see navbar with user info
  await expect(page.locator('[alt="User avatar"]')).toBeVisible()
})

test('unauthenticated user redirects to login', async ({ page }) => {
  await page.goto('/workspaces')

  // Should redirect to login
  await expect(page).toHaveURL(/\/login/)
})
```

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-23 | 1.0 | Initial story creation from PRD Epic 1 Story 1.5 | Sarah (PO Agent) |

---

## Dev Agent Record

### Agent Model Used
*To be populated by development agent*

### Debug Log References
*To be populated by development agent*

### Completion Notes List
*To be populated by development agent*

### File List
*To be populated by development agent*

---

## QA Results
*To be populated by QA agent after implementation review*
