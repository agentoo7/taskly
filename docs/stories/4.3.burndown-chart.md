# Story 4.3: Sprint Burndown Chart

## Status
Draft

---

## Story

**As a** team lead,
**I want** to see a sprint burndown chart,
**so that** I can track progress and identify if we're on track to complete the sprint.

---

## Acceptance Criteria

1. Sprint detail view displays burndown chart: line graph showing remaining story points over time
2. X-axis shows sprint days (Day 1 to Day N), Y-axis shows story points
3. Ideal burndown line (straight line from total points to zero) shown as dashed gray line
4. Actual burndown line shows actual remaining points, updated when cards move to "Done"
5. Burndown recalculated daily via Celery periodic task (runs at midnight UTC)
6. Chart data stored in `sprint_burndown` table: sprint_id, date, remaining_points, completed_points
7. Chart shows current progress indicator: "On Track" (green), "Behind" (yellow), "Ahead" (blue)
8. Hovering over data point shows tooltip: "Day 5: 18 points remaining"
9. Chart responsive: full width on desktop, scrollable on mobile
10. Export chart as PNG image via "Export" button

---

## Tasks / Subtasks

- [ ] **Task 1: Create sprint_burndown table** (AC: 6)
  - [ ] Fields: id, sprint_id, date, remaining_points, completed_points, created_at
  - [ ] Create migration

- [ ] **Task 2: Implement daily burndown calculation** (AC: 5, 6)
  - [ ] Celery periodic task runs daily at midnight
  - [ ] Calculate remaining points (cards not in "Done" column)
  - [ ] Store in sprint_burndown table

- [ ] **Task 3: Create burndown chart component** (AC: 1, 2, 3, 4, 8, 9)
  - [ ] Use recharts or chart.js library
  - [ ] Plot ideal vs actual burndown
  - [ ] Responsive design
  - [ ] Tooltip on hover

- [ ] **Task 4: Add progress indicator** (AC: 7)
  - [ ] Compare actual vs ideal at current day
  - [ ] Show status: On Track, Behind, Ahead

- [ ] **Task 5: Implement chart export** (AC: 10)
  - [ ] Use html2canvas to capture chart as PNG
  - [ ] Download file

- [ ] **Task 6: Write tests** (AC: 1-10)
  - [ ] Unit test: Burndown calculation
  - [ ] Integration test: Daily task creates burndown record

---

## Dev Notes

### Burndown Calculation

```python
@shared_task
def calculate_daily_burndown():
    """Calculate burndown for all active sprints."""
    active_sprints = Sprint.query.filter_by(status='active').all()

    for sprint in active_sprints:
        cards = Card.query.filter_by(sprint_id=sprint.id).all()
        remaining_points = sum(
            c.story_points or 0
            for c in cards
            if c.column_id not in done_column_ids
        )
        completed_points = sum(
            c.story_points or 0
            for c in cards
            if c.column_id in done_column_ids
        )

        SprintBurndown.create(
            sprint_id=sprint.id,
            date=date.today(),
            remaining_points=remaining_points,
            completed_points=completed_points
        )
```

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-23 | 1.0 | Initial story creation from PRD Epic 4 Story 4.3 | Sarah (PO Agent) |
