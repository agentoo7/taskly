# 🎯 COMPLETE AI UI GENERATION PROMPT FOR TASKLY CARD DETAIL MODAL

> **Generated by:** Sally (UX Expert)
> **Date:** 2025-10-22
> **Target Tools:** Lovable.dev, Vercel V0, or similar AI frontend generation tools
> **Component:** Card Detail Modal (Expandable Task View)

---

## 🚀 PROMPT START

```
# PROJECT CONTEXT

You are building the Card Detail Modal for "Taskly" - an expandable overlay that displays full card metadata, linked pull requests, activity timeline, and enables inline editing of all task fields. This modal is the primary interface for detailed task management and preserves task-to-code context.

## Tech Stack
- **Framework:** Next.js 14+ (App Router with TypeScript)
- **Styling:** Tailwind CSS v3+
- **Component Library:** shadcn/ui (Dialog, Tabs, Textarea, Select components)
- **Markdown:** react-markdown + remark-gfm (GitHub-flavored markdown support)
- **Icons:** Lucide React

## Design Philosophy
- **Context preservation:** All task information visible without leaving modal
- **Inline editing:** Click-to-edit UX with auto-save (2s debounce)
- **Git integration visibility:** PR status, commits, CI results prominent
- **Activity transparency:** Complete audit trail of all card changes

---

# HIGH-LEVEL GOAL

Create a fully functional card detail modal (800px width, 90vh height) with three tabbed sections (Details | Activity | Linked PRs), inline editing for all fields with auto-save, markdown editor with live preview for description/acceptance criteria, linked PR display with status badges and commit info, chronological activity timeline with comments, keyboard shortcuts (Escape to close, ⌘+Enter to save comment), and real-time update indicators.

---

# DETAILED STEP-BY-STEP INSTRUCTIONS

## Phase 1: Modal Structure & Layout

1. Create `components/card/card-detail-modal.tsx` using shadcn/ui Dialog:
   - Dimensions: 800px width, 90vh max height, centered on screen
   - Semi-transparent backdrop (rgba(0,0,0,0.6) with backdrop-blur)
   - Modal container: white background, rounded corners, shadow-2xl
   - Click backdrop or press Escape to close
   - Focus trap (Tab cycles through interactive elements inside modal)

2. Modal header (fixed at top):
   - Left: Card ID in monospace (CARD-123) + editable title (inline, auto-saves on blur)
   - Right: Close button (X icon) + Delete button (trash icon, red hover)
   - Border bottom: 1px neutral-200

3. Modal body layout:
   - Tab navigation bar (Details | Activity | Linked PRs) - sticky below header
   - Scrollable content area for active tab
   - Footer (conditional, only on Details tab): Save status indicator (hidden when auto-saved, shows "Saving..." during debounce)

## Phase 2: Tab Navigation

4. Create tab bar using shadcn/ui Tabs component:
   - Tabs: Details (default) | Activity | Linked PRs
   - Active tab: Blue underline (3px) + primary text color
   - Inactive tabs: Secondary text, hover shows underline preview
   - Tab content area scrollable independently
   - Keyboard: Ctrl+1/2/3 switches tabs

## Phase 3: Details Tab (Most Complex)

5. Create `components/card/details-tab.tsx` with form sections:

### Section 1: Description (Markdown Editor)
   - Label: "Description" (semibold, 12px)
   - Markdown editor with two modes:
     - Edit mode (default): Textarea with markdown syntax (```, **, *, etc.)
     - Preview mode: Rendered markdown with GitHub styling
   - Mode toggle: [Edit | Preview] button in top-right of section
   - Toolbar (optional): Bold, Italic, Link, Code, List buttons
   - Auto-save: Debounce 2s after last keystroke
   - Placeholder: "Add a description... (Markdown supported)"

### Section 2: Acceptance Criteria (Markdown Editor)
   - Same markdown editor pattern as Description
   - Label: "Acceptance Criteria"
   - Placeholder: "Define success criteria... (Markdown supported)"
   - Common pattern: Checklist format (`- [ ] Item 1`)

### Section 3: Metadata Grid (2-column layout)
   - **Assignees** (left column):
     - Multi-select dropdown with avatar + name
     - Show selected assignees as avatar chips (removable)
     - Max 10 assignees, scroll if more
   - **Priority** (right column):
     - Single-select dropdown: Low | Medium | High | Urgent
     - Show priority with colored dot + label
   - **Story Points** (left column):
     - Number input (0-100) or select common values (1, 2, 3, 5, 8, 13, 21)
     - Nullable (can be unset)
   - **Due Date** (right column):
     - Date picker (calendar overlay)
     - Show relative time on select: "Due in 5 days"
     - Red text if overdue
   - **Labels** (left column):
     - Multi-select with color-coded badge preview
     - Create new label inline (name + color picker)
   - **Sprint** (right column):
     - Single-select dropdown of available sprints
     - Option: "No sprint (Backlog)"

6. Auto-save behavior for all fields:
   - Input blur triggers save
   - Debounce 2s for text inputs (description, acceptance criteria)
   - Immediate save for dropdowns/selects
   - Show toast notification: "Card updated" (bottom-right, 2s)
   - Loading spinner in field during save (small, inline)

## Phase 4: Activity Tab

7. Create `components/card/activity-tab.tsx` with chronological timeline:

### Activity Timeline
   - Reverse chronological order (newest first)
   - Activity types:
     - **Comment:** User avatar + comment text (markdown) + timestamp
     - **Status change:** System message "Alice moved this card to In Progress" + timestamp
     - **Assignment change:** "Bob assigned this to Alice" + timestamp
     - **PR linked:** "Charlie linked PR #123" + PR badge + timestamp
     - **PR merged:** "PR #123 merged by GitHub" + green badge + timestamp
     - **Field update:** "Alice changed priority from Low to High" + timestamp

### Activity Item Design
   - Left: User avatar (32px) or system icon
   - Right: Content area
     - Top: User name (bold) + action text (regular) + timestamp (secondary, relative: "2h ago")
     - Bottom: Content (comment text, old → new values for updates)
   - Connector line between avatars (vertical gray line, 2px)

### Comment Composer
   - Fixed at bottom of Activity tab (sticky)
   - Textarea for comment text (markdown supported)
   - [Edit | Preview] toggle
   - Submit button: "Comment" (primary) + keyboard shortcut indicator (⌘+Enter)
   - Avatar of current user on left

8. Comment submission:
   - Keyboard: ⌘+Enter or Ctrl+Enter submits
   - Button click submits
   - Optimistic UI: Comment appears immediately in timeline
   - Show "Sending..." status briefly
   - Clear textarea on success
   - Focus returns to textarea

## Phase 5: Linked PRs Tab

9. Create `components/card/linked-prs-tab.tsx`:

### PR List
   - Show all linked PRs (usually 1-3, rarely more)
   - Each PR displayed as a card component:
     - Header: PR title (link to GitHub) + PR number badge
     - Status row: PR status badge (Draft/Open/Approved/Merged) + CI status (Pending/Running/Passed/Failed)
     - Metadata row: Branch name (monospace) + commit count + last updated timestamp
     - Footer: Author avatar + name + "Last updated 2h ago"
   - PR status colors:
     - Draft: Gray (#6E7681)
     - Open: Blue (#0366D6)
     - Approved: Green (#2DA44E) with checkmark
     - Merged: Purple (#8B5CF6)
     - Closed: Red (#CF222E)
   - CI status icons:
     - Pending: Gray dot
     - Running: Yellow spinner (animated)
     - Passed: Green checkmark
     - Failed: Red X

### PR Actions
   - "+ Link Pull Request" button (top-right):
     - Opens dialog with URL input
     - Validates GitHub PR URL format
     - Auto-links on valid URL
     - Shows success toast: "PR #123 linked"
   - "Create Branch" button (if no PRs linked):
     - Opens dialog with branch name input
     - Pre-filled: `feature/CARD-123-title-slug`
     - User can edit before creating
     - Calls GitHub API (mock for now)
     - On success: Shows "Branch created" + option to create PR

### Empty State
   - If no PRs linked:
     - Centered illustration (GitHub icon)
     - Message: "No pull requests linked yet"
     - CTA: "Create Branch" button + "Link Existing PR" button

10. PR card interactive features:
    - Click PR title: Opens GitHub PR in new tab
    - Click branch name: Copies branch name to clipboard + toast "Branch name copied"
    - Hover PR card: Shows "View on GitHub" tooltip
    - Unlink button (X icon, top-right): Confirms "Unlink PR #123?" → removes link

## Phase 6: Keyboard Shortcuts

11. Implement global modal shortcuts:
    - **Escape:** Close modal (unless typing in input)
    - **⌘+Enter (Details tab):** Save all changes immediately (bypasses debounce)
    - **⌘+Enter (Activity tab):** Submit comment
    - **Ctrl+1/2/3:** Switch to Details/Activity/Linked PRs tab
    - **E:** Focus title editor (if not already in input)
    - **C:** Focus comment textarea (Activity tab)

12. Show keyboard shortcut hints:
    - Tooltip on comment textarea: "⌘+Enter to submit"
    - Footer hint on Details tab: "Press ⌘+Enter to save"

## Phase 7: Real-Time Updates

13. Simulate real-time updates (WebSockets in prod, mock for now):
    - When another user comments: New activity appears in timeline with slide-in animation
    - When PR status changes: Linked PRs tab shows updated badge + flash animation (300ms blue glow)
    - When card updated: Show banner at top "This card was updated. Refresh to see changes." with Refresh button

14. Visual indicators for real-time changes:
    - Yellow pulse on tab badge if new activity: "Activity (2)" with pulsing dot
    - Blue flash on PR card when CI status updates
    - Smooth animations for new timeline items (slide down, 200ms)

## Phase 8: Loading & Error States

15. Loading states:
    - Initial modal load: Skeleton for title, description, metadata (pulsing gray boxes)
    - Tab content loading: Spinner centered in tab area
    - Auto-save in progress: Small spinner next to field + "Saving..." text

16. Error states:
    - Save failed: Red toast "Failed to save changes. Retry?" with Retry button
    - PR link invalid: Inline error below URL input "Invalid GitHub PR URL"
    - Comment failed: Red banner "Comment failed to post. Try again?" + Retry button
    - Network error: Full modal error state "Unable to load card details. Check your connection." + Retry button

## Phase 9: Accessibility

17. WCAG AA compliance:
    - Modal has focus trap (Tab cycles within modal)
    - Close button has aria-label: "Close card details"
    - All form fields have associated labels (visible or aria-label)
    - Tab navigation: role="tablist" with proper ARIA attributes
    - Activity timeline: role="feed" with aria-live="polite" for new items
    - Keyboard shortcuts documented and accessible

18. Screen reader support:
    - Announce modal open: "Card details for CARD-123"
    - Tab switch announced: "Details tab selected"
    - Auto-save announced: "Card updated" (via aria-live region)
    - Comment posted announced: "Comment added"

## Phase 10: Responsive Behavior

19. Desktop (1024px+): Full 800px width modal
20. Tablet (768-1023px): 90% width, max 700px
21. Mobile (<768px): Full-screen modal (100% width, 100vh height), tabs become scrollable horizontal bar

---

# CODE EXAMPLES, DATA STRUCTURES & CONSTRAINTS

## Modal Structure Example

```tsx
// components/card/card-detail-modal.tsx
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Card } from '@/types/board';

interface CardDetailModalProps {
  card: Card;
  isOpen: boolean;
  onClose: () => void;
  onUpdate: (updates: Partial<Card>) => Promise<void>;
}

export function CardDetailModal({ card, isOpen, onClose, onUpdate }: CardDetailModalProps) {
  const [activeTab, setActiveTab] = useState('details');
  const [isSaving, setIsSaving] = useState(false);

  const handleFieldUpdate = useDebouncedCallback(async (field: string, value: any) => {
    setIsSaving(true);
    await onUpdate({ [field]: value });
    setIsSaving(false);
    toast.success('Card updated');
  }, 2000);

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="max-w-[800px] max-h-[90vh] flex flex-col">
        {/* Header */}
        <DialogHeader>
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-2">
              <span className="font-mono text-sm text-secondary">{card.id}</span>
              <input
                type="text"
                defaultValue={card.title}
                onBlur={(e) => handleFieldUpdate('title', e.target.value)}
                className="text-lg font-semibold border-none focus:ring-2 focus:ring-primary"
              />
            </div>
            <button onClick={onClose} aria-label="Close card details">
              <X className="w-5 h-5" />
            </button>
          </div>
        </DialogHeader>

        {/* Tabs */}
        <Tabs value={activeTab} onValueChange={setActiveTab} className="flex-1 overflow-hidden">
          <TabsList>
            <TabsTrigger value="details">Details</TabsTrigger>
            <TabsTrigger value="activity">Activity</TabsTrigger>
            <TabsTrigger value="prs">Linked PRs</TabsTrigger>
          </TabsList>

          <TabsContent value="details" className="overflow-y-auto">
            <DetailsTab card={card} onUpdate={handleFieldUpdate} />
          </TabsContent>

          <TabsContent value="activity" className="overflow-y-auto">
            <ActivityTab cardId={card.id} />
          </TabsContent>

          <TabsContent value="prs" className="overflow-y-auto">
            <LinkedPRsTab prs={card.linkedPRs} cardId={card.id} />
          </TabsContent>
        </Tabs>

        {/* Footer */}
        {isSaving && (
          <div className="text-xs text-secondary flex items-center gap-2">
            <Loader2 className="w-3 h-3 animate-spin" />
            <span>Saving changes...</span>
          </div>
        )}
      </DialogContent>
    </Dialog>
  );
}
```

## Activity Data Structure

```typescript
export type ActivityType =
  | 'comment'
  | 'status_change'
  | 'assignment'
  | 'pr_linked'
  | 'pr_merged'
  | 'field_update';

export interface Activity {
  id: string;
  cardId: string;
  type: ActivityType;
  userId: string; // User who performed action
  user: User; // Populated user object
  timestamp: string; // ISO date
  data: {
    // For comments
    commentText?: string;
    // For status changes
    oldColumn?: string;
    newColumn?: string;
    // For assignments
    assignedTo?: User;
    // For PR events
    prNumber?: number;
    prUrl?: string;
    // For field updates
    field?: string;
    oldValue?: any;
    newValue?: any;
  };
}
```

## Design Constraints - DO NOT DEVIATE

- **Modal Dimensions:** 800px width, 90vh max height, centered
- **Backdrop:** rgba(0,0,0,0.6) with 8px backdrop-blur
- **Tab Bar Height:** 48px with 3px blue underline for active tab
- **Auto-save Debounce:** 2000ms (2 seconds) for text fields
- **PR Status Colors:** Draft (gray #6E7681), Open (blue #0366D6), Approved (green #2DA44E), Merged (purple #8B5CF6)
- **Activity Timeline:** Reverse chronological (newest first), 32px avatars, 2px connector lines
- **Markdown Editor:** Use react-markdown with remark-gfm, GitHub-flavored styling
- **Keyboard Shortcuts:** Escape (close), ⌘+Enter (save/comment), Ctrl+1/2/3 (switch tabs)

## DO NOT Include These Features (Out of Scope)

- ❌ Rich text WYSIWYG editor (use plain markdown textarea only)
- ❌ File attachments (images, PDFs, etc.)
- ❌ @mentions with autocomplete (future feature)
- ❌ Emoji picker (users can paste emoji manually)
- ❌ Activity filtering (show all activities always)
- ❌ Export card as PDF/Markdown
- ❌ Duplicate card button
- ❌ Convert card to template

---

# STRICT SCOPE DEFINITION

## What You SHOULD Create (In Scope)

✅ **Files to Create:**
1. `components/card/card-detail-modal.tsx` - Main modal container with tabs
2. `components/card/details-tab.tsx` - Details form with metadata grid
3. `components/card/activity-tab.tsx` - Activity timeline + comment composer
4. `components/card/linked-prs-tab.tsx` - PR list with link/unlink functionality
5. `components/card/markdown-editor.tsx` - Reusable markdown editor with edit/preview toggle
6. `components/card/activity-item.tsx` - Single activity timeline item
7. `components/card/pr-card.tsx` - PR display card with status badges
8. `types/activity.ts` - Activity and related types

✅ **Functionality to Implement:**
- Modal with three tabs (Details, Activity, Linked PRs)
- Inline editing with auto-save (2s debounce)
- Markdown editor with edit/preview modes
- Activity timeline (chronological feed)
- Comment composer with ⌘+Enter submission
- PR linking via URL input
- Branch creation dialog (placeholder for GitHub API)
- Keyboard shortcuts (Escape, ⌘+Enter, Ctrl+1/2/3)
- Real-time update indicators (mock)
- Loading states (skeleton, spinners)
- Error states (save failed, invalid PR URL)
- Accessibility (focus trap, ARIA labels, screen reader support)

## What You MUST NOT Modify (Out of Scope)

❌ Same restrictions as previous prompts (no auth, no real API calls, no backend)

---

# VISUAL STYLE GUIDANCE

## Modal Design Patterns

**Overlay Hierarchy:**
- Backdrop (z-index: 40, semi-transparent dark)
- Modal container (z-index: 50, white card elevated)
- Dropdowns/tooltips within modal (z-index: 51)

**Tab Content Scrolling:**
- Tab bar is sticky (always visible during scroll)
- Tab content area scrolls independently
- Scrollbar styled to match design system (thin, primary color thumb)

**Inline Editing UX:**
- Fields show no border until focused (click-to-edit pattern)
- Focus: Blue border appears (2px solid primary)
- Blur: Triggers save + removes border
- Hover: Subtle background change (neutral-50) indicates editability

---

# FINAL REMINDERS

## Testing Your Implementation

**Manual Test Checklist:**
1. Open modal (should focus title input)
2. Edit title, click outside (should auto-save after 2s)
3. Switch to Activity tab (Ctrl+2 shortcut should work)
4. Type comment, press ⌘+Enter (comment should post)
5. Switch to Linked PRs tab (should show empty state if no PRs)
6. Click "Link Pull Request", enter invalid URL (error should show)
7. Enter valid PR URL (PR should appear in list)
8. Press Escape (modal should close)
9. Reopen modal, verify data persisted
10. Test on mobile width (modal should go full-screen)

**Accessibility Testing:**
- Tab through all interactive elements (should stay within modal)
- Press Escape (modal closes, focus returns to trigger)
- Use screen reader (VoiceOver/NVDA): All content should be announced
- Keyboard-only navigation (no mouse) should complete all tasks

---

## END OF PROMPT

Copy the entire prompt above and paste it into Lovable or V0.
```

🚀 PROMPT END
